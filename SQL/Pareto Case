Identify the minimum set of customers who together contribute to at least 80% of total revenue. 
Classic Paretto Case - eg 80% of traffic is during 20% of rush hours of day only.

Tables - orders
order_id	customer_id	order_date	revenue

Approach:
1. aggregate revenue at the customer level
2. rank customers by total revenue and compute a running cumulative sum using window functions.
3. divide the running total by overall revenue to calculate cumulative contribution and filter customers contributing up to 80%.

SQL Code:
-- 1. Cte used to group by customers for sum(revenue)
WITH customer_revenue AS ( SELECT customer_id, SUM(revenue) AS customer_total_revenue FROM orders GROUP BY customer_id),

--2. window funct to get rank and running total
ranked_customers AS (
    SELECT customer_id, customer_total_revenue,
--running total      
SUM(customer_total_revenue) OVER ( ORDER BY customer_total_revenue DESC) AS running_revenue, 
-- total revenue generated by all customer
SUM(customer_total_revenue) OVER () AS total_revenue
FROM customer_revenue
)
SELECT customer_id, customer_total_revenue,  running_revenue * 1.0 / total_revenue AS cumulative_revenue_pct
FROM ranked_customers
WHERE running_revenue * 1.0 / total_revenue <= 0.8
ORDER BY customer_total_revenue DESC;

Follow ups:
No â€” NTILE / percentiles solve a different problem than Pareto. They segment customers by count, not by revenue contribution.
